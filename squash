#!/usr/bin/env bash


# Define variables
COLORS="$1"
echo "${COLORS}"
CACHE_DIR=~/.cache/squash
THEME_DIR=~/.config/squash/themes
OB_DIR=~/.local/share/themes/generic/openbox-3

# Remove all previous colors
cleanup() {
	rm -f $CACHE_DIR/colors
}

# Relaod .Xresources using xrdb
reload_x() {
	write_xcolors
	xrdb ~/.Xresources
}

# Write colors.css file to the CACHE_DIR
write_css() {
cat > $CACHE_DIR/colors.css << EOL
:root {
	--background: ${main_bg};
	--foreground: ${fg};

	--color0: ${blk};
	--color1: ${red};
	--color2: ${grn};
	--color3: ${ylw};
	--color4: ${blu};
	--color5: ${mag};
	--color6: ${cyn};
	--color7: ${wht};
	--color8: ${bblk};
	--color9: ${bred};
	--color10: ${bgrn};
	--color11: ${bylw};
	--color12: ${bblu};
	--color13: ${bmag};
	--color14: ${bcyn};
	--color15: ${bwht};
}
EOL

cat ${CACHE_DIR}/colors.css
}

# Write colors to be used by lemonbar
# You will need to either change these names 
# or the names of your lemonbar variables for this to work. 
write_lemonbar_colors() {
cat > ~/colors.sh << EOL
#!/usr/bin/env bash

#colors
text=${fg}
fg=${fg}
warning="#e17878"
bg="${bg}"
red="${red}"
grn="${grn}"
ylw="${ylw}"
blu="${blu}"
mag="${mag}"
cyn="${cyn}"

#other stuff
trs="%{F#00000000}"
txt="%{F$fg}"
wrn="%{F$warning}"

obbg=${red}
obibg=${fg}
cpubg=${red}
winbg=${ylw}
netbg=${ylw}
volbg=${grn}
batbg=${mag}
malbg=${red}

obfg=${fg}
obifg=${bg}
cpufg=${fg}
winfg=${bg}
netfg=${bg}
volfg=${fg}
batfg=${fg}
malfg=${fg}

# accents
acc0="${acc0}"
acc1="${acc1}"
acc2="${acc2}"
acc3="${acc2}"
acc4="${acc3}"

a0="%{B$acc0}"
a1="%{B$acc1}"
a2="%{B$acc2}"
a3="%{B$acc3}"
a4="%{B$acc4}"

af0="%{F$acc0}"
af1="%{F$acc1}"
af2="%{F$fg}"

bgt="%{B$fg}"
bgf="%{F$bg}"
EOL

cat $CACHE_DIR/colors.sh

}

# Write generic colors to be used by .Xresources
write_xcolors() {
cat > $CACHE_DIR/colors << EOL
#define bg ${bg}
#define fg ${fg}
#define blk ${blk}
#define bblk ${bblk}
#define red ${red}
#define grn ${grn}
#define ylw ${ylw}
#define blu ${blu}
#define mag ${mag}
#define cyn ${cyn}
#define wht ${wht}
#define bred ${bred}
#define bgrn ${bgrn}
#define bylw ${bylw}
#define bblu ${bblu}
#define bmag ${bmag}
#define bcyn ${bcyn}
#define bwht ${bwht}
EOL

cat $CACHE_DIR/colors
}

write_xreload() {
cat > $CACHE_DIR/colorXReload << EOL

!speical
*.foreground:  ${fg}
*.background:  ${bg}
*.cursorColor: ${fg}

!black
*.color0:      ${blk}
*.color8:      ${bblk}

!red
*.color1:      ${red}
*.color9:      ${bred}

!grn
*.color2:      ${grn}
*.color10:     ${bgrn}

!ylw
*.color3:      ${ylw}
*.color11:     ${bylw}

!blu
*.color4:      ${blu}
*.color12:     ${bblu}

!mag
*.color5:      ${mag}
*.color13:     ${bmag}

!cyn
*.color6:      ${cyn}
*.color14:     ${bcyn}

!wht
*.color7:      ${wht}
*.color15:     ${bwht}
EOL

cat $CACHE_DIR/colorXReload
}


# Kills and reloads polybar
reload_pbar() {
	pkill -x polybar
	#polybar base &
	polybar clite &
}

reload_xterm() {
   colorswitcher $CACHE_DIR/colorXReload
}

# Kills and reloads lemonbar
reload_lemonbar() {
	pkill -x lemonbar
	bar &
}

reload_2bwm() {
   morphr &
}

# Sets wallpaper based on wallpaper in squash theme file
set_wallpaper() {
	pkill -x nitrogen
	nitrogen --set-zoom-fill ${wallpaper}
}

main() {
	cleanup
	. $THEME_DIR/${COLORS}
	write_xcolors
   write_xreload
	write_css
	reload_x
	reload_pbar
   reload_2bwm
   reload_xterm
   set_wallpaper
}

main "$@"
